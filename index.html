<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>ðŸš¤ CanalPilot - Route Calculator</title><link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" /><script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script><style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:Arial,sans-serif;background:linear-gradient(135deg,#74ebd5,#acb6e5);padding:20px;min-height:100vh}.container{max-width:1600px;margin:0 auto;display:grid;grid-template-columns:1fr 1fr 1fr;gap:20px}h1{grid-column:1/-1;text-align:center;color:white;font-size:28px;margin-bottom:20px}.panel{background:white;padding:20px;border-radius:8px;box-shadow:0 4px 15px rgba(0,0,0,0.1)}h2{color:#333;font-size:18px;margin-bottom:15px;border-bottom:2px solid #007BFF;padding-bottom:10px}.input-group{margin-bottom:15px}label{display:block;font-weight:bold;margin-bottom:5px;color:#555;font-size:13px}.search-box{width:100%;padding:10px;border:2px solid #ddd;border-radius:5px;font-size:14px}.search-box:focus{outline:none;border-color:#007BFF}.search-results{position:absolute;background:white;border:2px solid #007BFF;border-top:none;border-radius:0 0 5px 5px;max-height:250px;overflow-y:auto;width:calc(100% - 4px);z-index:100;display:none}.search-results.show{display:block}.search-item{padding:8px;cursor:pointer;border-bottom:1px solid #eee;font-size:12px}.search-item:hover{background:#f0f8ff}.selected-badge{background:#e8f5e9;padding:8px;border-radius:5px;border-left:4px solid #28a745;font-size:12px;margin-top:8px;display:none}.selected-badge.show{display:block}.button-group{display:flex;gap:10px;margin:20px 0}button{flex:1;padding:10px;background-color:#007BFF;color:white;border:none;border-radius:5px;cursor:pointer;font-weight:bold}button:hover{background-color:#0056b3}#map{height:600px;border-radius:8px}.map-panel{grid-column:2/4;padding:0}.stats{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin:15px 0}.stat-box{background:#f0f8ff;padding:12px;border-radius:5px;border-left:4px solid #007BFF;text-align:center}.stat-label{font-size:11px;color:#666}.stat-value{font-size:20px;font-weight:bold;color:#007BFF}.features-list{max-height:400px;overflow-y:auto}.feature-item{padding:10px;margin:8px 0;background:#f9f9f9;border-left:4px solid #007BFF;border-radius:4px;font-size:12px;cursor:pointer}.feature-item:hover{background:#f0f0f0}.badge{display:inline-block;padding:2px 6px;border-radius:10px;color:white;font-size:10px;font-weight:bold;margin-right:5px}.badge-lock{background:#ff6b6b}.badge-bridge{background:#4ecdc4}.badge-marina{background:#45b7d1}.badge-wharf{background:#96ceb4}.badge-water{background:#3498db}.badge-tunnel{background:#95a5a6}.badge-junction{background:#667eea}.empty-state{text-align:center;padding:30px 10px;color:#999}.route-info{background:#e8f5e9;padding:10px;border-radius:5px;margin:10px 0;border-left:4px solid #28a745;font-size:12px}.search-container{position:relative}@media (max-width:1200px){.container{grid-template-columns:1fr 1fr}.map-panel{grid-column:1/-1}h1{grid-column:1/-1}}</style></head><body><h1>ðŸš¤ CanalPilot - Route Calculator</h1><div class="container"><div class="panel"><h2>Route Setup</h2><div class="input-group"><label>Start Point:</label><div class="search-container"><input type="text" id="startSearch" class="search-box" placeholder="Type to search..."><div id="startResults" class="search-results"></div></div><div id="startBadge" class="selected-badge"></div></div><div class="input-group"><label>End Point:</label><div class="search-container"><input type="text" id="endSearch" class="search-box" placeholder="Type to search..."><div id="endResults" class="search-results"></div></div><div id="endBadge" class="selected-badge"></div></div><div id="routeInfo" class="route-info" style="display:none">Distance: <strong id="routeDist">0</strong> mi | Duration: <strong id="routeDur">0</strong></div><h2>Calculate</h2><div class="input-group"><label>Speed (mph):</label><input type="number" id="speed" value="3" min="0.5" max="10" step="0.5" class="search-box"></div><div class="input-group"><label>Lookahead (hours):</label><input type="number" id="lookahead" value="2" min="0.5" max="24" step="0.5" class="search-box"></div><div class="button-group"><button onclick="calculateLookahead()">Calculate</button><button onclick="resetForm()">Reset</button></div></div><div class="panel"><h2>Upcoming Features</h2><div id="results"><div class="empty-state">Select start point and click Calculate</div></div></div><div class="panel map-panel"><div id="map"></div></div></div><script src="./testCorridor.js"></script><script>let map;let markers=[];let routeLine=null;let startMarker;let endMarker;let currentStart=null;let currentEnd=null;function initMap(){map=L.map('map').setView([52.36,-1.1],10);L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'Â© OpenStreetMap',maxZoom:19}).addTo(map);setupSearch('startSearch','startResults','startBadge','start');setupSearch('endSearch','endResults','endBadge','end');}function setupSearch(inputId,resultsId,badgeId,type){const input=document.getElementById(inputId);const resultsDiv=document.getElementById(resultsId);input.addEventListener('input',function(){const query=this.value.toLowerCase();resultsDiv.innerHTML='';if(query.length===0){resultsDiv.classList.remove('show');return;}const filtered=testCorridor.features.filter(f=>f.name.toLowerCase().includes(query)).slice(0,15);filtered.forEach(f=>{const div=document.createElement('div');div.className='search-item';div.textContent=f.name+' ('+f.cumulativeDistance+' mi)';div.addEventListener('click',function(){input.value=f.name;resultsDiv.classList.remove('show');const badge=document.getElementById(badgeId);badge.textContent='\u2713 '+f.name;badge.classList.add('show');if(type==='start'){currentStart=f;}else{currentEnd=f;}updateRouteInfo();if(type==='start'&&startMarker){map.removeLayer(startMarker);}if(type==='end'&&endMarker){map.removeLayer(endMarker);}const marker=L.marker([f.latitude,f.longitude]).addTo(map).bindPopup(f.name).openPopup();if(type==='start'){startMarker=marker;}else{endMarker=marker;}map.setView([f.latitude,f.longitude],13);});resultsDiv.appendChild(div);});if(filtered.length>0){resultsDiv.classList.add('show');}});document.addEventListener('click',function(e){if(!input.contains(e.target)&&!resultsDiv.contains(e.target)){resultsDiv.classList.remove('show');}});}function updateRouteInfo(){if(currentStart&&currentEnd){const dist=Math.abs(currentEnd.cumulativeDistance-currentStart.cumulativeDistance).toFixed(2);const speed=parseFloat(document.getElementById('speed').value)||3;const totalHours=(dist/speed);const h=Math.floor(totalHours);const m=Math.round((totalHours-h)*60);document.getElementById('routeDist').textContent=dist;document.getElementById('routeDur').textContent=h+'h '+m+'m';document.getElementById('routeInfo').style.display='block';}}function getBadgeClass(type){const types={'lock':'badge-lock','bridge':'badge-bridge','marina':'badge-marina','wharf':'badge-wharf','water':'badge-water','tunnel':'badge-tunnel','junction':'badge-junction'};return types[type]||'badge-junction';}function calculateLookahead(){if(!currentStart){alert('Please select a start point first.');return;}const speed=parseFloat(document.getElementById('speed').value)||3;const lookahead=parseFloat(document.getElementById('lookahead').value)||2;const rangeDistance=speed*lookahead;const startDist=currentStart.cumulativeDistance;const northbound=!currentEnd||currentEnd.cumulativeDistance>=startDist;let upcoming;if(northbound){const limitDist=currentEnd?Math.min(currentEnd.cumulativeDistance,startDist+rangeDistance):startDist+rangeDistance;upcoming=testCorridor.features.filter(f=>f.cumulativeDistance>startDist&&f.cumulativeDistance<=limitDist);}else{const limitDist=Math.max(currentEnd.cumulativeDistance,startDist-rangeDistance);upcoming=testCorridor.features.filter(f=>f.cumulativeDistance>=limitDist&&f.cumulativeDistance<startDist);}markers.forEach(m=>map.removeLayer(m));markers=[];if(routeLine){map.removeLayer(routeLine);routeLine=null;}const resultsDiv=document.getElementById('results');if(upcoming.length===0){resultsDiv.innerHTML='<div class="empty-state">No features found in lookahead window</div>';}else{const locks=upcoming.filter(f=>f.type==='lock').length;resultsDiv.innerHTML='<div class="stats"><div class="stat-box"><div class="stat-label">Features</div><div class="stat-value">'+upcoming.length+'</div></div><div class="stat-box"><div class="stat-label">Locks</div><div class="stat-value">'+locks+'</div></div></div>'+upcoming.map(f=>'<div class="feature-item" onclick="map.setView(['+f.latitude+','+f.longitude+'],15)"><span class="badge '+getBadgeClass(f.type)+'">'+f.type+'</span><strong>'+f.name+'</strong><br><small>'+f.cumulativeDistance+' mi'+(f.description?' \u2013 '+f.description:'')+'</small></div>').join('');}if(currentEnd){const minDist=Math.min(startDist,currentEnd.cumulativeDistance);const maxDist=Math.max(startDist,currentEnd.cumulativeDistance);const routePoints=testCorridor.features.filter(f=>f.cumulativeDistance>=minDist&&f.cumulativeDistance<=maxDist).map(f=>[f.latitude,f.longitude]);if(routePoints.length>1){routeLine=L.polyline(routePoints,{color:'#007BFF',weight:4,opacity:0.8}).addTo(map);}}upcoming.forEach(f=>{const m=L.marker([f.latitude,f.longitude]).addTo(map).bindPopup('<strong>'+f.name+'</strong><br>Type: '+f.type+'<br>'+f.cumulativeDistance+' mi');markers.push(m);});const allPoints=[[currentStart.latitude,currentStart.longitude],...(currentEnd?[[currentEnd.latitude,currentEnd.longitude]]:[]),...upcoming.map(f=>[f.latitude,f.longitude])];const bounds=L.latLngBounds(allPoints);map.fitBounds(bounds,{padding:[20,20]});}function resetForm(){document.getElementById('startSearch').value='';document.getElementById('endSearch').value='';document.getElementById('speed').value='3';document.getElementById('lookahead').value='2';document.getElementById('startBadge').classList.remove('show');document.getElementById('endBadge').classList.remove('show');document.getElementById('routeInfo').style.display='none';document.getElementById('startResults').classList.remove('show');document.getElementById('endResults').classList.remove('show');currentStart=null;currentEnd=null;markers.forEach(m=>map.removeLayer(m));markers=[];if(routeLine){map.removeLayer(routeLine);routeLine=null;}if(startMarker){map.removeLayer(startMarker);startMarker=null;}if(endMarker){map.removeLayer(endMarker);endMarker=null;}document.getElementById('results').innerHTML='<div class="empty-state">Select start point and click Calculate</div>';map.setView([52.36,-1.1],10);}window.onload=initMap;</script></body></html>