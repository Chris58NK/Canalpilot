<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>üö§ CanalPilot - Lookahead Calculator with Map</title><link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" /><script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script><style>body{background:linear-gradient(to right,#74ebd5,#acb6e5);font-family:Arial,sans-serif;margin:0;padding:20px}.container{display:grid;grid-template-columns:1fr 1fr 1fr;gap:20px;max-width:1600px;margin:0 auto}.panel{background:white;padding:30px;border-radius:10px;box-shadow:0 4px 15px rgba(0,0,0,0.1)}#map{height:600px;border-radius:10px;box-shadow:0 4px 15px rgba(0,0,0,0.1)}h1{grid-column:1/-1;text-align:center;color:white;font-size:32px;margin:0 0 30px 0}h2{color:#333;margin-top:0;border-bottom:2px solid #007BFF;padding-bottom:10px}h3{color:#555;font-size:14px;margin-top:20px;margin-bottom:10px}.input-group{margin-bottom:20px}label{display:block;font-weight:bold;margin-bottom:8px;color:#555;font-size:13px}input[type=number],select{width:100%;padding:10px;border:2px solid #ddd;border-radius:5px;font-size:14px;box-sizing:border-box}input[type=number]:focus,select:focus{outline:0;border-color:#007BFF}.button-group{display:flex;gap:10px}button{flex:1;background-color:#007BFF;color:white;border:0;padding:12px 20px;border-radius:5px;cursor:pointer;font-size:16px;font-weight:bold;transition:background-color .3s}button:hover{background-color:#0056b3}.feature-item{padding:12px;margin-bottom:10px;border-left:4px solid #007BFF;background-color:#f9f9f9;border-radius:4px;font-size:13px;cursor:pointer;transition:all .3s}.feature-item:hover{background-color:#f0f0f0;transform:translateX(4px)}.feature-item.lock{border-left-color:#ff6b6b;background-color:#ffe6e6}.feature-item.bridge{border-left-color:#4ecdc4;background-color:#e6f9f8}.feature-item.marina{border-left-color:#45b7d1;background-color:#e6f3f9}.feature-item.wharf{border-left-color:#96ceb4;background-color:#e6f7ee}.feature-item.water{border-left-color:#3498db;background-color:#e6f2f9}.feature-item.tunnel{border-left-color:#95a5a6;background-color:#e6e6e6}.feature-item.junction{border-left-color:#667eea;background-color:#e6e9f9}.feature-item.aqueduct{border-left-color:#f39c12;background-color:#fff3e6}.feature-item.narrows{border-left-color:#e74c3c;background-color:#ffe6e6}.feature-item.weir{border-left-color:#9b59b6;background-color:#f3e6f9}.feature-item.restaurant{border-left-color:#e91e63;background-color:#ffe6f3}.feature-item.winding{border-left-color:#00bcd4;background-color:#e6f9f9}.badge{display:inline-block;padding:3px 8px;border-radius:12px;color:white;font-size:11px;font-weight:bold;margin-right:8px}.badge-lock{background-color:#ff6b6b}.badge-bridge{background-color:#4ecdc4}.badge-marina{background-color:#45b7d1}.badge-wharf{background-color:#96ceb4}.badge-water{background-color:#3498db}.badge-tunnel{background-color:#95a5a6}.badge-junction{background-color:#667eea}.badge-aqueduct{background-color:#f39c12}.badge-narrows{background-color:#e74c3c}.badge-weir{background-color:#9b59b6}.badge-restaurant{background-color:#e91e63}.badge-winding{background-color:#00bcd4}.scroll-container{max-height:400px;overflow-y:auto;padding-right:10px}.scroll-container::-webkit-scrollbar{width:8px}.scroll-container::-webkit-scrollbar-track{background:#f1f1f1;border-radius:10px}.scroll-container::-webkit-scrollbar-thumb{background:#888;border-radius:10px}.scroll-container::-webkit-scrollbar-thumb:hover{background:#555}.stats{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:20px;padding-top:15px;border-top:2px solid #ddd}.stat-box{background-color:#f0f8ff;padding:15px;border-radius:5px;text-align:center;border:1px solid #007BFF}.stat-label{font-size:12px;color:#666;margin-bottom:5px}.stat-value{font-size:24px;font-weight:bold;color:#007BFF}.empty-state{text-align:center;padding:40px 20px;color:#999}.feature-details{margin-top:5px;font-size:12px;color:#666}.map-panel{grid-column:2/-1;padding:0}.route-info{background-color:#f0f8ff;padding:12px;border-radius:5px;margin-bottom:15px;border-left:4px solid #28a745;font-size:13px}.route-info strong{color:#28a745}@media (max-width:1200px){.container{grid-template-columns:1fr 1fr}.map-panel{grid-column:1/-1}h1{grid-column:1/-1}}@media (max-width:768px){.container{grid-template-columns:1fr}#map{height:400px}}.leaflet-popup-content{font-size:12px}.feature-item.highlighted{background-color:#fff3cd!important;border-left:4px solid #ffc107!important}</style></head><body><h1>üö§ CanalPilot - Leicester Section Navigator with Map</h1><div class="container"><div class="panel"><h2>Route Setup</h2><h3>üìç Start Point</h3><div class="input-group"><label for="startPoint">Choose Start:</label><select id="startPoint" onchange="updateStartPoint()"><option value="">-- Select Start Point --</option></select></div><h3>üéØ End Point</h3><div class="input-group"><label for="endPoint">Choose End:</label><select id="endPoint" onchange="updateEndPoint()"><option value="">-- Select End Point --</option></select></div><div id="routeInfo" class="route-info" style="display:none"><strong>Route Distance:</strong> <span id="routeDistance">0</span> miles<br><strong>Route Duration (@ 3mph):</strong> <span id="routeDuration">0</span></div><h3>‚öôÔ∏è Calculation</h3><div class="input-group"><label for="speed">Speed (mph):</label><input type="number" id="speed" placeholder="3" value="3" min="0.5" max="10" step="0.5"></div><div class="input-group"><label for="lookahead">Lookahead (hours):</label><input type="number" id="lookahead" placeholder="2" value="2" min="0.5" max="24" step="0.5"></div><div class="button-group"><button onclick="calculateLookahead()">Calculate</button><button onclick="resetForm()">Reset</button></div><div class="stats"><div class="stat-box"><div class="stat-label">Corridor Length</div><div class="stat-value">23.1 mi</div></div><div class="stat-box"><div class="stat-label">Total Features</div><div class="stat-value">104</div></div></div></div><div class="panel"><h2>Upcoming Features</h2><div id="results"><div class="empty-state">Choose start/end points and click Calculate</div></div></div><div class="panel map-panel"><div id="map"></div></div></div><script src="testCorridor.js"></script><script>let map=null,markers=[],polyline=null,startMarker=null,endMarker=null,currentStartPoint=null,currentEndPoint=null;function initMap(){map=L.map('map').setView([52.36,-1.1],10),L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'¬© OpenStreetMap contributors',maxZoom:19}).addTo(map);const e=document.getElementById('startPoint'),t=document.getElementById('endPoint');testCorridor.features.forEach(n=>{const o=document.createElement('option');o.value=n.id,o.text=`${n.name} (${n.cumulativeDistance.toFixed(2)} mi)`,e.appendChild(o);const i=document.createElement('option');i.value=n.id,i.text=`${n.name} (${n.cumulativeDistance.toFixed(2)} mi)`,t.appendChild(i)})}function decimalToTime(e){const t=Math.floor(e),n=Math.round(60*(e-t));return 0===t?`${n}m`:0===n?`${t}h`:`${t}h ${n}m`}function getFeatureColor(e){return{lock:'#ff6b6b',bridge:'#4ecdc4',marina:'#45b7d1',wharf:'#96ceb4',water:'#3498db',tunnel:'#95a5a6',junction:'#667eea',aqueduct:'#f39c12',narrows:'#e74c3c',weir:'#9b59b6',restaurant:'#e91e63',winding:'#00bcd4'}[e]||'#007BFF'}function updateStartPoint(){const e=parseInt(document.getElementById('startPoint').value);e&&(currentStartPoint=testCorridor.features.find(t=>t.id===e),addStartMarker())}function updateEndPoint(){const e=parseInt(document.getElementById('endPoint').value);e&&(currentEndPoint=testCorridor.features.find(t=>t.id===e),addEndMarker())}function addStartMarker(){startMarker&&map.removeLayer(startMarker),currentStartPoint&&(startMarker=L.marker([currentStartPoint.latitude,currentStartPoint.longitude],{icon:L.divIcon({html:'<div style="background-color: #28a745; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 16px; border: 2px solid white;">S</div>',iconSize:[32,32],className:'start-marker'})}).bindPopup(`<strong>START: ${currentStartPoint.name}</strong>`).addTo(map)),updateRouteInfo()}function addEndMarker(){endMarker&&map.removeLayer(endMarker),currentEndPoint&&(endMarker=L.marker([currentEndPoint.latitude,currentEndPoint.longitude],{icon:L.divIcon({html:'<div style="background-color: #dc3545; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 16px; border: 2px solid white;">E</div>',iconSize:[32,32],className:'end-marker'})}).bindPopup(`<strong>END: ${currentEndPoint.name}</strong>`).addTo(map)),updateRouteInfo()}function updateRouteInfo(){if(currentStartPoint&&currentEndPoint){const e=currentEndPoint.cumulativeDistance-currentStartPoint.cumulativeDistance,t=parseFloat(document.getElementById('speed').value)||3;document.getElementById('routeDistance').textContent=e.toFixed(2),document.getElementById('routeDuration').textContent=decimalToTime(e/t),document.getElementById('routeInfo').style.display='block'}else document.getElementById('routeInfo').style.display='none'}function calculateLookahead(){if(!currentStartPoint)return void alert('Please select a start point');const e=parseFloat(document.getElementById('speed').value),t=parseFloat(document.getElementById('lookahead').value);if(isNaN(e)||e<=0)return void alert('Please enter a valid speed');if(isNaN(t)||t<=0)return void alert('Please enter a valid lookahead time');const n=currentStartPoint.cumulativeDistance+e*t,o=testCorridor.features.filter(e=>e.cumulativeDistance>currentStartPoint.cumulativeDistance&&e.cumulativeDistance<=n);currentEndPoint&&currentEndPoint.cumulativeDistance<n&&o.push(...testCorridor.features.filter(e=>e.cumulativeDistance>n&&e.cumulativeDistance<=currentEndPoint.cumulativeDistance)),o.sort((e,t)=>e.cumulativeDistance-t.cumulativeDistance);const i=document.getElementById('results');if(i.innerHTML='',0===o.length)return i.innerHTML='<div class="empty-state">No features found in lookahead window</div>',void clearFeatureMarkers();const a=o.filter(e=>'lock'===e.type).length,s=o.filter(e=>'bridge'===e.type).length,r=o.filter(e=>'marina'===e.type).length;i.innerHTML=`<div class="stats"><div class="stat-box"><div class="stat-label">Features Ahead</div><div class="stat-value">${o.length}</div></div><div class="stat-box"><div class="stat-label">Locks Ahead</div><div class="stat-value">${a}</div></div><div class="stat-box"><div class="stat-label">Bridges Ahead</div><div class="stat-value">${s}</div></div><div class="stat-box"><div class="stat-label">Marinas Ahead</div><div class="stat-value">${r}</div></div></div>`;const l=document.createElement('div');l.className='scroll-container',o.forEach(e=>{const t=(e.cumulativeDistance-currentStartPoint.cumulativeDistance)/e,n=decimalToTime(t);l.innerHTML+=`<div class="feature-item ${e.type}" onclick="highlightFeature(${e.id})"><span class="badge badge-${e.type}">${e.type.toUpperCase()}</span><strong>${e.name}</strong><div class="feature-details">Distance: ${e.cumulativeDistance.toFixed(2)} mi | ETA: ${n} | Chainage: ${e.chainage}m | Locks: ${e.linkLocks>0?e.linkLocks:'‚Äî'}</div></div>`}),i.appendChild(l),updateMapFeatures(o)}function updateMapFeatures(e){clearFeatureMarkers();const t=e.map(e=>[e.latitude,e.longitude]);t.length>0&&(polyline=L.polyline(t,{color:'#667eea',weight:3,opacity:.7}).addTo(map)),e.forEach(e=>{const t=getFeatureColor(e.type),n=L.marker([e.latitude,e.longitude],{icon:L.divIcon({html:`<div style="background-color: ${t}; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 12px;">${e.type.charAt(0).toUpperCase()}</div>`,iconSize:[24,24],className:'custom-marker'})}).bindPopup(`<strong>${e.name}</strong><br>Type: ${e.type}<br>Distance: ${e.cumulativeDistance.toFixed(2)} mi<br>Chainage: ${e.chainage}m<br>Locks: ${e.linkLocks>0?e.linkLocks:'‚Äî'}`).addTo(map);markers.push(n)});const n=[];currentStartPoint&&n.push([currentStartPoint.latitude,currentStartPoint.longitude]),e.forEach(e=>n.push([e.latitude,e.longitude])),currentEndPoint&&n.push([currentEndPoint.latitude,currentEndPoint.longitude]),n.length>0&&map.fitBounds(L.latLngBounds(n),{padding:[50,50]})}function clearFeatureMarkers(){markers.forEach(e=>map.removeLayer(e)),markers=[],polyline&&(map.removeLayer(polyline),polyline=null)}function highlightFeature(e){const t=testCorridor.features.find(t=>t.id===e);t&&map&&map.setView([t.latitude,t.longitude],14)}function resetForm(){document.getElementById('startPoint').value='',document.getElementById('endPoint').value='',document.getElementById('speed').value='3',document.getElementById('lookahead').value='2',document.getElementById('results').innerHTML='<div class="empty-state">Choose start/end points and click Calculate</div>',document.getElementById('routeInfo').style.display='none',currentStartPoint=null,currentEndPoint=null,clearFeatureMarkers(),startMarker&&map.removeLayer(startMarker),endMarker&&map.removeLayer(endMarker),startMarker=null,endMarker=null}window.addEventListener('load',()=>{initMap(),console.log('CanalPilot loaded with',testCorridor.features.length,'features')})</script></body></html>